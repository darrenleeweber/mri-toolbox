<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                "http://www.w3.org/TR/REC-html40/loose.dtd">
<html>
<head>
  <title>Description of extractresults2freesurfer</title>
  <meta name="keywords" content="extractresults2freesurfer">
  <meta name="description" content="Loop over all controls and patients">
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <meta name="generator" content="m2html &copy; 2003 Guillaume Flandin">
  <meta name="robots" content="index, follow">
  <link type="text/css" rel="stylesheet" href="../m2html.css">
</head>
<body>
<a name="_top"></a>
<div><a href="../index.html">Home</a> &gt;  <a href="index.html">mri_toolbox</a> &gt; extractresults2freesurfer.m</div>

<!--<table width="100%"><tr><td align="left"><a href="../index.html"><img alt="<" border="0" src="../left.png">&nbsp;Master index</a></td>
<td align="right"><a href="index.html">Index for mri_toolbox&nbsp;<img alt=">" border="0" src="../right.png"></a></td></tr></table>-->

<h1>extractresults2freesurfer
</h1>

<h2><a name="_name"></a>PURPOSE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>Loop over all controls and patients</strong></div>

<h2><a name="_synopsis"></a>SYNOPSIS <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="box"><strong>This is a script file. </strong></div>

<h2><a name="_description"></a>DESCRIPTION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre class="comment"> Loop over all controls and patients</pre></div>

<!-- crossreference -->
<h2><a name="_cross"></a>CROSS-REFERENCE INFORMATION <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
This function calls:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
This function is called by:
<ul style="list-style-image:url(../matlabicon.gif)">
</ul>
<!-- crossreference -->


<h2><a name="_source"></a>SOURCE CODE <a href="#_top"><img alt="^" border="0" src="../up.png"></a></h2>
<div class="fragment"><pre>0001 
0002 <span class="comment">% Loop over all controls and patients</span>
0003 
0004 <span class="comment">% Search ImageGridTime for selected time point</span>
0005 <span class="comment">% Extract Cdata from ImageGridAmp at selected time (column)</span>
0006 
0007 <span class="comment">%----------------------------------------------</span>
0008 <span class="comment">% Define component timing</span>
0009 
0010 sa=[100 <span class="comment">% first positive peak P100 (OT)</span>
0011     150 <span class="comment">% positive &amp; negative peak P150 (SF) / N150 (OT)</span>
0012     180 <span class="comment">% negative N180 @ PT,AT and SP,SC</span>
0013     250 <span class="comment">% positive P250 (SP)</span>
0014     400 ]; <span class="comment">% P400 (SC,SP)</span>
0015 
0016 wm=[ 80
0017      90 
0018     150
0019     260
0020     300
0021     400
0022     550 ];
0023 
0024 ea=[ 80 <span class="comment">% N80  @ SF        , P80  @ OT/PT</span>
0025     145   <span class="comment">% N150 @ OT/PT     , P150 @ SPF (SC)</span>
0026     240   <span class="comment">%                  , P240 @ SPF/IPF &amp; OT/SP</span>
0027     300   <span class="comment">% N300 @ L_PT/OT/IP,</span>
0028     350   <span class="comment">% Series: P350 @ Frontal (IPF), P500 @ SP</span>
0029     450   <span class="comment">% Series: P350 @ Frontal (IPF), P500 @ SP</span>
0030     550 ];<span class="comment">% Series: P350 @ Frontal (IPF), P500 @ SP; Also N550 @ left frontal</span>
0031 
0032 <span class="comment">%----------------------------------------------</span>
0033 <span class="comment">% Define groups</span>
0034 groups = {<span class="string">'c'</span>,<span class="string">'p'</span>};
0035 
0036 <span class="comment">% cd E:\matlab\brainstorm_v1\studies; extractresults2freesurfer</span>
0037 
0038 <span class="comment">%----------------------------------------------</span>
0039 <span class="comment">% Define subjects</span>
0040 subs = [1:10];
0041 
0042 cond = {<span class="string">'ea'</span>,<span class="string">'sa'</span>,<span class="string">'wm'</span>};
0043 
0044 <span class="keyword">for</span> g=1:length(groups),
0045     <span class="keyword">for</span> s=1:length(subs),
0046         
0047         sub = sprintf(<span class="string">'%s%02d'</span>,groups{g},subs(s));
0048         
0049         
0050         <span class="comment">% temporarily skip subject c04</span>
0051         <span class="keyword">if</span> strmatch(sub,<span class="string">'c04'</span>), <span class="keyword">continue</span>; <span class="keyword">end</span>
0052         
0053         
0054         
0055         <span class="comment">%----------------------------------------------------</span>
0056         <span class="comment">% Load cortical tesselation from subjecttess.mat</span>
0057         
0058         subtessfile = [<span class="string">'E:\matlab\brainstorm_v1\subjects\'</span>,sub,filesep,sub,<span class="string">'_subjecttess.mat'</span>];
0059         
0060         <span class="keyword">if</span> exist(subtessfile) ~= 2,
0061             <span class="comment">% skip this group/subject, as no data available</span>
0062             fprintf(<span class="string">'\nskipping subject: %s\n\n'</span>,sub);
0063             <span class="keyword">continue</span>;
0064         <span class="keyword">else</span>
0065             p.mesh.path = [<span class="string">'E:\matlab\brainstorm_v1\subjects\'</span>,sub,filesep];
0066             p.mesh.file = [sub,<span class="string">'_subjecttess.mat'</span>];
0067             p.mesh.type = <span class="string">'BrainStorm'</span>;
0068             p = mesh_open(p);
0069             
0070             p.mesh.current = mesh_check(p,<span class="string">'cortex'</span>);
0071             
0072             <span class="comment">% effectively remove all extraneous surfaces for mesh_write_freesurfer below</span>
0073             indices = strcmp(p.mesh.data.meshtype,<span class="string">'cortex'</span>);
0074             exclude = find(indices == 0);
0075             p.mesh.data.meshtype(exclude) = [];
0076             
0077         <span class="keyword">end</span>
0078         
0079         
0080         <span class="comment">%----------------------------------------------------</span>
0081         <span class="comment">% define cortical source activity matrix file names</span>
0082         
0083         <span class="comment">%c01_oac_volts_data_results_image_svd12.mat</span>
0084         <span class="comment">%c01_ouc_volts_data_results_image_svd12.mat</span>
0085         oucfile = [<span class="string">'E:\matlab\brainstorm_v1\studies\'</span>,sub,filesep,sub,<span class="string">'_ouc_volts_data_results_image_svd12.mat'</span>];
0086         oacfile = [<span class="string">'E:\matlab\brainstorm_v1\studies\'</span>,sub,filesep,sub,<span class="string">'_oac_volts_data_results_image_svd12.mat'</span>];
0087         oatfile = [<span class="string">'E:\matlab\brainstorm_v1\studies\'</span>,sub,filesep,sub,<span class="string">'_oat_volts_data_results_image_svd12.mat'</span>];
0088         tacfile = [<span class="string">'E:\matlab\brainstorm_v1\studies\'</span>,sub,filesep,sub,<span class="string">'_tac_volts_data_results_image_svd12.mat'</span>];
0089         
0090         <span class="keyword">if</span> exist(oucfile) ~= 2, error([<span class="string">'no '</span>,oucfile]); <span class="keyword">end</span>;
0091         <span class="keyword">if</span> exist(oacfile) ~= 2, error([<span class="string">'no '</span>,oacfile]); <span class="keyword">end</span>;
0092         <span class="keyword">if</span> exist(oatfile) ~= 2, error([<span class="string">'no '</span>,oatfile]); <span class="keyword">end</span>;
0093         <span class="keyword">if</span> exist(tacfile) ~= 2, error([<span class="string">'no '</span>,tacfile]); <span class="keyword">end</span>;
0094         
0095         <span class="comment">%----------------------------------------------------</span>
0096         <span class="comment">% Save Cdata to freesurfer curvature files</span>
0097         
0098         <span class="comment">% D:\freesurfer\subjects\ptsdpet-c01\surf</span>
0099         p.mesh.path = sprintf(<span class="string">'D:\\freesurfer\\subjects\\ptsdpet-%s\\surf\\'</span>,sub);
0100         
0101         p.mesh.type = <span class="string">'FS_curv'</span>; <span class="comment">% output freesurfer binary curvature files</span>
0102         
0103         <span class="comment">% cortical values are scaled into nano A.m (dipole moment)</span>
0104         scale = 10^9;
0105         
0106         
0107         <span class="keyword">for</span> c = 1:length(cond),
0108             
0109             
0110             <span class="keyword">switch</span> cond{c},
0111                 
0112             <span class="keyword">case</span> <span class="string">'sa'</span>,
0113                 
0114                 <span class="comment">%---------------------------------------------------------------------</span>
0115                 <span class="comment">% SA condition</span>
0116                 
0117                 vert = size(p.mesh.data.vertices{p.mesh.current},1);
0118                 times = length(sa);
0119                 
0120                 Dif.oac = zeros(vert,times);
0121                 Dif.ouc = Dif.oac;
0122                 
0123                 load(oacfile,<span class="string">'ImageGridAmp'</span>,<span class="string">'ImageGridTime'</span>); <span class="comment">% Time is in sec here</span>
0124                 <span class="keyword">for</span> t=1:length(sa),
0125                     
0126                     <span class="comment">% find column of ImageGridAmp corresponding to wm(t)</span>
0127                     col = find(ImageGridTime == sa(t)/1000);
0128                     <span class="keyword">if</span> isempty(col), error(<span class="string">'Cannot find time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0129                     <span class="keyword">if</span> length(col) &gt; 1, error(<span class="string">'&gt; 1 matching time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0130                     
0131                     p.mesh.data.Cdata{p.mesh.current} = abs(ImageGridAmp(:,col) .* scale);
0132                     Dif.oac(:,t) = p.mesh.data.Cdata{p.mesh.current};
0133                     
0134                     p.mesh.file = sprintf(<span class="string">'rh.sa_%04d_oac_float'</span>,sa(t));
0135                     mesh_write(p);
0136                     
0137                 <span class="keyword">end</span>
0138                 
0139                 clear ImageGridAmp ImageGridTime; pack;
0140                 
0141                 load(oucfile,<span class="string">'ImageGridAmp'</span>,<span class="string">'ImageGridTime'</span>); <span class="comment">% Time is in sec here</span>
0142                 <span class="keyword">for</span> t=1:length(sa),
0143                     
0144                     <span class="comment">% find column of ImageGridAmp corresponding to sa(t)</span>
0145                     col = find(ImageGridTime == sa(t)/1000);
0146                     <span class="keyword">if</span> isempty(col), error(<span class="string">'Cannot find time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0147                     <span class="keyword">if</span> length(col) &gt; 1, error(<span class="string">'&gt; 1 matching time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0148                     
0149                     p.mesh.data.Cdata{p.mesh.current} = abs(ImageGridAmp(:,col) .* scale);
0150                     Dif.ouc(:,t) = p.mesh.data.Cdata{p.mesh.current};
0151                     
0152                     p.mesh.file = sprintf(<span class="string">'rh.sa_%04d_ouc_float'</span>,sa(t));
0153                     mesh_write(p);
0154                 <span class="keyword">end</span>
0155                 
0156                 clear ImageGridAmp ImageGridTime; pack;
0157                 
0158                 <span class="keyword">for</span> t=1:length(sa),
0159                     
0160                     p.mesh.data.Cdata{p.mesh.current} = abs(Dif.oac(:,t) - Dif.ouc(:,t));
0161                     p.mesh.file = sprintf(<span class="string">'rh.sa_%04d_dif_float'</span>,sa(t));
0162                     mesh_write(p);
0163                     
0164                 <span class="keyword">end</span>
0165                 
0166                 clear Dif; pack;
0167                 
0168                 
0169                 
0170             <span class="keyword">case</span> <span class="string">'wm'</span>,
0171                 
0172                 <span class="comment">%---------------------------------------------------------------------</span>
0173                 <span class="comment">% WM condition</span>
0174                 
0175                 vert = size(p.mesh.data.vertices{p.mesh.current},1);
0176                 times = length(wm);
0177                 
0178                 Dif.tac = zeros(vert,times);
0179                 Dif.oac = Dif.tac;
0180                 
0181                 load(tacfile,<span class="string">'ImageGridAmp'</span>,<span class="string">'ImageGridTime'</span>); <span class="comment">% Time is in sec here</span>
0182                 <span class="keyword">for</span> t=1:length(wm),
0183                     
0184                     <span class="comment">% find column of ImageGridAmp corresponding to wm(t)</span>
0185                     col = find(ImageGridTime == wm(t)/1000);
0186                     <span class="keyword">if</span> isempty(col), error(<span class="string">'Cannot find time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0187                     <span class="keyword">if</span> length(col) &gt; 1, error(<span class="string">'&gt; 1 matching time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0188                     
0189                     p.mesh.data.Cdata{p.mesh.current} = abs(ImageGridAmp(:,col) .* scale);
0190                     Dif.tac(:,t) = p.mesh.data.Cdata{p.mesh.current};
0191                     
0192                     p.mesh.file = sprintf(<span class="string">'rh.wm_%04d_tac_float'</span>,wm(t));
0193                     mesh_write(p);
0194                     
0195                 <span class="keyword">end</span>
0196                 
0197                 clear ImageGridAmp ImageGridTime; pack;
0198                 
0199                 load(oacfile,<span class="string">'ImageGridAmp'</span>,<span class="string">'ImageGridTime'</span>); <span class="comment">% Time is in sec here</span>
0200                 <span class="keyword">for</span> t=1:length(wm),
0201                     
0202                     <span class="comment">% find column of ImageGridAmp corresponding to sa(t)</span>
0203                     col = find(ImageGridTime == wm(t)/1000);
0204                     <span class="keyword">if</span> isempty(col), error(<span class="string">'Cannot find time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0205                     <span class="keyword">if</span> length(col) &gt; 1, error(<span class="string">'&gt; 1 matching time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0206                     
0207                     p.mesh.data.Cdata{p.mesh.current} = abs(ImageGridAmp(:,col) .* scale);
0208                     Dif.oac(:,t) = p.mesh.data.Cdata{p.mesh.current};
0209                     
0210                     p.mesh.file = sprintf(<span class="string">'rh.wm_%04d_oac_float'</span>,wm(t));
0211                     mesh_write(p);
0212                 <span class="keyword">end</span>
0213                 
0214                 clear ImageGridAmp ImageGridTime; pack;
0215                 
0216                 <span class="keyword">for</span> t=1:length(wm),
0217                     
0218                     p.mesh.data.Cdata{p.mesh.current} = abs(Dif.tac(:,t) - Dif.oac(:,t));
0219                     p.mesh.file = sprintf(<span class="string">'rh.wm_%04d_dif_float'</span>,wm(t));
0220                     mesh_write(p);
0221                     
0222                 <span class="keyword">end</span>
0223                 
0224                 clear Dif; pack;
0225                 
0226                 
0227                 
0228             <span class="keyword">case</span> <span class="string">'ea'</span>,
0229                 
0230                 <span class="comment">%---------------------------------------------------------------------</span>
0231                 <span class="comment">% EA condition</span>
0232                 
0233                 vert = size(p.mesh.data.vertices{p.mesh.current},1);
0234                 times = length(ea);
0235                 
0236                 Dif.oat = zeros(vert,times);
0237                 Dif.oac = Dif.oat;
0238                 
0239                 load(oatfile,<span class="string">'ImageGridAmp'</span>,<span class="string">'ImageGridTime'</span>); <span class="comment">% Time is in sec here</span>
0240                 <span class="keyword">for</span> t=1:length(ea),
0241                     
0242                     <span class="comment">% find column of ImageGridAmp corresponding to sa(t)</span>
0243                     col = find(ImageGridTime == ea(t)/1000);
0244                     <span class="keyword">if</span> isempty(col), error(<span class="string">'Cannot find time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0245                     <span class="keyword">if</span> length(col) &gt; 1, error(<span class="string">'&gt; 1 matching time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0246                     
0247                     p.mesh.data.Cdata{p.mesh.current} = abs(ImageGridAmp(:,col) .* scale);
0248                     Dif.oat(:,t) = p.mesh.data.Cdata{p.mesh.current};
0249                     
0250                     p.mesh.file = sprintf(<span class="string">'rh.ea_%04d_oat_float'</span>,ea(t));
0251                     mesh_write(p);
0252                     
0253                 <span class="keyword">end</span>
0254                 
0255                 clear ImageGridAmp ImageGridTime; pack;
0256                 
0257                 load(oacfile,<span class="string">'ImageGridAmp'</span>,<span class="string">'ImageGridTime'</span>); <span class="comment">% Time is in sec here</span>
0258                 <span class="keyword">for</span> t=1:length(ea),
0259                     
0260                     <span class="comment">% find column of ImageGridAmp corresponding to sa(t)</span>
0261                     col = find(ImageGridTime == ea(t)/1000);
0262                     <span class="keyword">if</span> isempty(col), error(<span class="string">'Cannot find time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0263                     <span class="keyword">if</span> length(col) &gt; 1, error(<span class="string">'&gt; 1 matching time column in ImageGridTime\n'</span>); <span class="keyword">end</span>
0264                     
0265                     p.mesh.data.Cdata{p.mesh.current} = abs(ImageGridAmp(:,col) .* scale);
0266                     Dif.oac(:,t) = p.mesh.data.Cdata{p.mesh.current};
0267                     
0268                     p.mesh.file = sprintf(<span class="string">'rh.ea_%04d_oac_float'</span>,ea(t));
0269                     mesh_write(p);
0270                 <span class="keyword">end</span>
0271                 
0272                 clear ImageGridAmp ImageGridTime; pack;
0273                 
0274                 <span class="keyword">for</span> t=1:length(ea),
0275                     
0276                     p.mesh.data.Cdata{p.mesh.current} = abs(Dif.oat(:,t) - Dif.oac(:,t));
0277                     p.mesh.file = sprintf(<span class="string">'rh.ea_%04d_dif_float'</span>,ea(t));
0278                     mesh_write(p);
0279                     
0280                 <span class="keyword">end</span>
0281                 
0282                 clear Dif; pack;
0283             <span class="keyword">end</span>
0284         <span class="keyword">end</span>
0285     <span class="keyword">end</span>
0286 <span class="keyword">end</span></pre></div>
<hr><address>Generated on Mon 29-Mar-2004 13:14:32 by <strong><a href="http://www.artefact.tk/software/matlab/m2html/">m2html</a></strong> &copy; 2003</address>
</body>
</html>